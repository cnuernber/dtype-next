<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>tech.v3.datatype.ffi documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">dtype-next</span> <span class="project-version">6.01-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="buffered-image.html"><div class="inner"><span>Buffered Image Support</span></div></a></li><li class="depth-1 "><a href="cheatsheet.html"><div class="inner"><span>Cheatsheet</span></div></a></li><li class="depth-1 "><a href="datatype-to-dtype-next.html"><div class="inner"><span>Why dtype-next?</span></div></a></li><li class="depth-1 "><a href="dimensions-bytecode-gen.html"><div class="inner"><span>Dimensions and Bytecode Generation</span></div></a></li><li class="depth-1 "><a href="overview.html"><div class="inner"><span>Overview</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tech</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>v3</span></div></div></li><li class="depth-3"><a href="tech.v3.datatype.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datatype</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.argops.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>argops</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.bitmap.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bitmap</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.datetime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datetime</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.errors.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>errors</span></div></a></li><li class="depth-4 branch current"><a href="tech.v3.datatype.ffi.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ffi</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.functional.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>functional</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.jna.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jna</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.list.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>list</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.mmap.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mmap</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.mmap-writer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mmap-writer</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.native-buffer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>native-buffer</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.nippy.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nippy</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.packing.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>packing</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.reductions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>reductions</span></div></a></li><li class="depth-4"><a href="tech.v3.datatype.rolling.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rolling</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -486px;"><span class="top" style="height: 495px;"></span><span class="bottom"></span></span><span>libs</span></div></div></li><li class="depth-4 branch"><a href="tech.v3.libs.buffered-image.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>buffered-image</span></div></a></li><li class="depth-4"><a href="tech.v3.libs.neanderthal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>neanderthal</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>parallel</span></div></div></li><li class="depth-4"><a href="tech.v3.parallel.for.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>for</span></div></a></li><li class="depth-3"><a href="tech.v3.tensor.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>tensor</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.tensor.color-gradients.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>color-gradients</span></div></a></li><li class="depth-4"><a href="tech.v3.tensor.dimensions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dimensions</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-arch64-set"><div class="inner"><span>arch64-set</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-c-.3Estring"><div class="inner"><span>c-&gt;string</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-define-foreign-interface"><div class="inner"><span>define-foreign-interface</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-define-library"><div class="inner"><span>define-library</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-ffi-impl*"><div class="inner"><span>ffi-impl*</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-find-function"><div class="inner"><span>find-function</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-find-symbol"><div class="inner"><span>find-symbol</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-fn-.3Ec"><div class="inner"><span>fn-&gt;c</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-jdk-ffi.3F"><div class="inner"><span>jdk-ffi?</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-jdk-mmodel.3F"><div class="inner"><span>jdk-mmodel?</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-jna-ffi.3F"><div class="inner"><span>jna-ffi?</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-load-library"><div class="inner"><span>load-library</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-lower-type"><div class="inner"><span>lower-type</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-PToPointer"><div class="inner"><span>PToPointer</span></div></a></li><li class="depth-2 branch"><a href="tech.v3.datatype.ffi.html#var--.3Epointer"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>-&gt;pointer</span></div></a></li><li class="depth-2"><a href="tech.v3.datatype.ffi.html#var-convertible-to-pointer.3F"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>convertible-to-pointer?</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-ptr-int-type"><div class="inner"><span>ptr-int-type</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-ptr-value"><div class="inner"><span>ptr-value</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-ptr-value.3F"><div class="inner"><span>ptr-value?</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-size-t-compile-time-switch"><div class="inner"><span>size-t-compile-time-switch</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-size-t-size"><div class="inner"><span>size-t-size</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-size-t-type"><div class="inner"><span>size-t-type</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-string-.3Ec"><div class="inner"><span>string-&gt;c</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">tech.v3.datatype.ffi</h1><div class="doc"><div class="markdown"><p>Generalized C FFI interface that unifies JNA and JDK-16 FFI architectures.</p></div></div><div class="public anchor" id="var-arch64-set"><h3>arch64-set</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L18">view source</a></div></div><div class="public anchor" id="var-c-.3Estring"><h3>c-&gt;string</h3><div class="usage"><code>(c-&gt;string data &amp; [encoding])</code></div><div class="doc"><div class="markdown"><p>Convert a zero-terminated c-string to a java string. See documentation for <code>string-&gt;c</code> for encodings.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L117">view source</a></div></div><div class="public anchor" id="var-define-foreign-interface"><h3>define-foreign-interface</h3><div class="usage"><code>(define-foreign-interface iface-symbol rettype argtypes &amp; [options])</code></div><div class="doc"><div class="markdown"><p>Define a strongly typed interface that can then be used with fn-&gt;c.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L297">view source</a></div></div><div class="public anchor" id="var-define-library"><h3>define-library</h3><div class="usage"><code>(define-library library-symbol fn-defs &amp; [options])</code></div><div class="doc"><div class="markdown"><p>Define a library. After this, it is legal to ‘import’ the symbol. The library  class file will be written out to <em>compile-path</em> - see documentation for  insn.core/write.</p>
<ul>
  <li>fn-defs - map of fn-name -&gt; {:rettype :argtypes} - see ‘find-function’.</li>
</ul>
<p>After this functionc call, if output-path is on the classpath then you can  ‘import’ the defined library. It’s constructor takes a string which is the  path of the library to bind to (or nil for current process) and it will have  a correctly-typed function defined for every key in fn-defs.</p>
<p>Example:</p>
<pre><code class="clojure">user&gt; (dtype-ffi/define-library 'tech.libmemset {:memset {:rettype :pointer
                                                          :argtypes [:pointer :int32 :size-t]}})
{:library tech.libmemset}
user&gt; (import 'tech.libmemset)
tech.libmemset
user&gt; (def inst (tech.libmemset. nil)) ;;nil for current process
#'user/inst
user&gt; (def test-buf (dtype/make-container :native-heap :float32 (range 10)))
#'user/test-buf
user&gt; test-buf
#native-buffer@0x00007F4E28CE56D0&lt;float32&gt;[10]
[0.000, 1.000, 2.000, 3.000, 4.000, 5.000, 6.000, 7.000, 8.000, 9.000, ]
user&gt; (.memset ^tech.libmemset inst test-buf 0 40)
#object[tech.v3.datatype.ffi.Pointer 0x33013c57 "{:address 0x00007F4E28CE56D0 }"]
user&gt; test-buf
#native-buffer@0x00007F4E28CE56D0&lt;float32&gt;[10]
[0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, ]
user&gt;
</code></pre></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L213">view source</a></div></div><div class="public anchor" id="var-ffi-impl*"><h3>ffi-impl*</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L182">view source</a></div></div><div class="public anchor" id="var-find-function"><h3>find-function</h3><div class="usage"><code>(find-function libname symbol-name rettype &amp; [argtypes options])</code></div><div class="doc"><div class="markdown"><p>Find the symbol and return an IFn implementation wrapping typesafe access to the function. The function’s signature has to be completely specified. Supported datatypes are:</p>
<ul>
  <li><code>:void</code> - return type only.</li>
  <li><code>:int8</code> <code>:int16</code> <code>:int32</code> <code>:int64</code></li>
  <li><code>:float32</code> <code>:float64</code></li>
  <li><code>:size-t</code> - int32 or int64 depending on cpu architecture.</li>
  <li><code>:pointer</code> <code>:pointer?</code> - Something convertible to a Pointer type. Potentially  exception when nil.</li>
</ul>
<p>This object’s -&gt;pointer method returns the actual function pointer.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L251">view source</a></div></div><div class="public anchor" id="var-find-symbol"><h3>find-symbol</h3><div class="usage"><code>(find-symbol libname symbol-name)</code><code>(find-symbol symbol-name)</code></div><div class="doc"><div class="markdown"><p>Find a symbol in a library. A library symbol is guaranteed to have a conversion to a pointer.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L204">view source</a></div></div><div class="public anchor" id="var-fn-.3Ec"><h3>fn-&gt;c</h3><div class="usage"><code>(fn-&gt;c ifn iface &amp; [options])</code></div><div class="doc"><div class="markdown"><p>Convert something implementing the Clojure IFn interface to a Pointer value. Callers must specify the C-interface they expect to be used. See find-function for the definition of rettype and argtypes. Returns a Pointer suitable to be passed to C functions as a callback with the given signature.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L303">view source</a></div></div><div class="public anchor" id="var-jdk-ffi.3F"><h3>jdk-ffi?</h3><div class="usage"><code>(jdk-ffi?)</code></div><div class="doc"><div class="markdown"><p>Is the JDK foreign function interface enabled?</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L60">view source</a></div></div><div class="public anchor" id="var-jdk-mmodel.3F"><h3>jdk-mmodel?</h3><div class="usage"><code>(jdk-mmodel?)</code></div><div class="doc"><div class="markdown"><p>Is the JDK native memory model enabled?</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L76">view source</a></div></div><div class="public anchor" id="var-jna-ffi.3F"><h3>jna-ffi?</h3><div class="usage"><code>(jna-ffi?)</code></div><div class="doc"><div class="markdown"><p>Is JNA’s ffi interface enabled?</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L68">view source</a></div></div><div class="public anchor" id="var-load-library"><h3>load-library</h3><div class="usage"><code>(load-library libname)</code></div><div class="doc"><div class="markdown"><p>Load a library returning an implementation specific library instance.</p>
<p>Exception if the library cannot be found.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L196">view source</a></div></div><div class="public anchor" id="var-lower-type"><h3>lower-type</h3><div class="usage"><code>(lower-type argtype)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L53">view source</a></div></div><div class="public anchor" id="var-PToPointer"><h3>PToPointer</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var--.3Epointer"><h3>-&gt;pointer</h3><div class="usage"><code>(-&gt;pointer item)</code></div><div class="doc"><div class="markdown"><p>Convert an item into a Pointer, throwing an exception upon failure.</p></div></div></div><div class="public anchor" id="var-convertible-to-pointer.3F"><h3>convertible-to-pointer?</h3><div class="usage"><code>(convertible-to-pointer? item)</code></div><div class="doc"><div class="markdown"><p>Query whether an item is convertible to a pointer.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L84">view source</a></div></div><div class="public anchor" id="var-ptr-int-type"><h3>ptr-int-type</h3><div class="usage"><code>(ptr-int-type)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L46">view source</a></div></div><div class="public anchor" id="var-ptr-value"><h3>ptr-value</h3><div class="usage"><code>(ptr-value item)</code></div><div class="doc"><div class="markdown"><p>Item must not be nil. A long address is returned.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L158">view source</a></div></div><div class="public anchor" id="var-ptr-value.3F"><h3>ptr-value?</h3><div class="usage"><code>(ptr-value? item)</code></div><div class="doc"><div class="markdown"><p>Item may be nil in which case 0 is returned.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L174">view source</a></div></div><div class="public anchor" id="var-size-t-compile-time-switch"><h3>size-t-compile-time-switch</h3><h4 class="type">macro</h4><div class="usage"><code>(size-t-compile-time-switch int-body long-body)</code></div><div class="doc"><div class="markdown"><p>Run either int32 based code or int64 based code depending on the runtime size of size-t</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L29">view source</a></div></div><div class="public anchor" id="var-size-t-size"><h3>size-t-size</h3><div class="usage"><code>(size-t-size)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L21">view source</a></div></div><div class="public anchor" id="var-size-t-type"><h3>size-t-type</h3><div class="usage"><code>(size-t-type)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L38">view source</a></div></div><div class="public anchor" id="var-string-.3Ec"><h3>string-&gt;c</h3><div class="usage"><code>(string-&gt;c str-data &amp; [encoding])</code></div><div class="doc"><div class="markdown"><p>Convert a java String to a zero-padded c-string. Available encodings are</p>
<ul>
  <li><code>:ascii</code>, <code>:utf-8</code> (default), <code>:utf-16</code>, and <code>:utf-32</code></li>
</ul>
<p>String data will be zero padded.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L100">view source</a></div></div></div></body></html>